<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Giphy!</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="assets/css/style.css"> 
    <link href="https://fonts.googleapis.com/css?family=Indie+Flower|Permanent+Marker" rel="stylesheet">
  
     <!-- JQuery -->
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
     <script src="https://code.jquery.com/jquery.js"></script>

     </head>
     <body>
         <h1 style="text-align:center">Giphy!</h1>
         <div class='row'>
             <div class="col-sm-7">
                    <div id="buttons"></div>
            </div>
            
             <div class="col-sm-5">
                    <input id='userInput'>
                    <button id='addButton'>Add</button>
                </div>
         </div>

         <div class='row'>
                <div class="col-sm-10">
                        <div id="giphyPlace"></div>
               </div>
            </div>

         

         <script>
          let apiKey = 'mGXUkk6sqAk5YSAWK1dfK9SNbNHpmzI6';
          var rating= 'rating=g'
          var queryURL = "http://api.giphy.com/v1/gifs/search?q=ryan+gosling&api_key="+apiKey+"&limit=5&"+rating;
          
          var qParameter=['happy','sad','angry','hungry','excited'];
         // http://api.giphy.com/v1/gifs/search?q=ryan+gosling&api_key=mGXUkk6sqAk5YSAWK1dfK9SNbNHpmzI6&limit=5
     
         function refreshButtons(){
         $("#buttons").empty();
            for (var index=0; index<qParameter.length; index ++){
             var giphyButton = $("<button>");
            giphyButton.addClass("giphy");
            giphyButton.attr("data-name", qParameter[index]);
            giphyButton.text(qParameter[index]);
            $('#buttons').append(giphyButton);
         }};

         $("#addButton").on("click", function(event) {

        event.preventDefault();
        var newGiphyButton = $("#userInput").val().trim();
        qParameter.push(newGiphyButton);
        $('#userInput').text("");
        refreshButtons();
      });


      refreshButtons();


      $(document).on("click", ".giphy", function(){

      var gif= $(this).attr("data-name");
      console.log(gif);
        $('#giphyPlace').empty();
      
      var queryURL = "https://api.giphy.com/v1/gifs/search?q=" +
        gif + "&api_key=mGXUkk6sqAk5YSAWK1dfK9SNbNHpmzI6&limit=5";
       
        $.ajax({
            url: queryURL,//+'&'+rating+'&q='+qParameter[0]
            method: "GET"
          })
         
          .done(function(response) {
        
            var results = response.data;
          
          

        
          for (var i = 0; i < results.length; i++) {

            if (results[i].rating !== "r" && results[i].rating !== "pg-13") {
             
              var gifDiv = $("<div class='item'>");

              var rating = results[i].rating;
              var animatedUrlArray = [];
              var stillUrlArray = [];
        
              var p = $("<p>").text("Rating: " + rating);

            
              var gif = $("<img id='giphyImages'>");
              gif.attr("src", results[i].images.fixed_height_still.url);
              gif.attr({'data-state': "still"});
              gif.attr("value", i);

            animatedUrlArray.push(results[i].images.fixed_height.url);
            stillUrlArray.push(results[i].images.fixed_height_still.url);
            console.log(animatedUrlArray);
               

                let urlStill = results[i].images.fixed_height_still.url;
                let urlAnimated = results[i].images.fixed_height.url;

                $(document).on("click", "#giphyImages", function(){
   
                    var state = $(this).attr("data-state");
                    // gifValue = $('.img').val();
                    // let urlStill = stillUrlArray[gifValue];
                    // let urlAnimated = animatedUrlArray[gifValue];
                    // console.log(gifValue);


                    if (state === "still") {
                        
                        $(this).attr("src", urlAnimated);
                        $(this).attr("data-state", "animate");
                    } else {
                        $(this).attr("src", urlStill);
                        $(this).attr("data-state", "still");
                    }
                });

         
              gifDiv.append(p);
              gifDiv.append(gif);

              $("#giphyPlace").prepend(gifDiv);
            }
          }

        });
       

    });

   
         </script>

     </body>
    </html>
